# قائمة مهام تطوير بوت AIPoweredProBot

## المرحلة 1: البنية الأساسية وإدارة البيانات (الخطوة 004)

- [x] **تعديل قاعدة البيانات (`database.py`):**
    - [x] إضافة حقل `wallet_balance` (رصيد المحفظة) إلى جدول `users`.
    - [x] إنشاء دالة `get_wallet_balance(user_id)`.
    - [x] إنشاء دالة `add_wallet_balance(user_id, amount)`.
    - [x] إنشاء دالة `deduct_wallet_balance(user_id, amount)` مع التحقق من الرصيد.
    - [ ] مراجعة وتحسين دالة `consume_request` للتعامل مع أولوية الخصم (حزم، اشتراك، محفظة؟ - بحاجة لتوضيح الأولوية).
    - [ ] إضافة جدول لتتبع معاملات Plisio (اختياري لكن موصى به).
- [x] **تعديل الأدوات المساعدة (`utils.py`):**
    - [x] تحديث دالة `format_account_status` لعرض `wallet_balance`.
- [ ] **تعديل معالجات المستخدم (`user_handlers.py`):**
    - [ ] تحديث `account_command` لاستخدام `format_account_status` المحدثة.
- [x] **تعديل الإعدادات (`config.py`):**
    - [x] إضافة مفتاح Plisio السري.

## المرحلة 2: الاشتراكات والحزم وبوابة الدفع (الخطوة 005)

- [x] **تطوير منطق الشراء (`bot.py`, `user_handlers.py`):**
    - [x] ربط أزرار شراء الحزم والاشتراكات بدالة `deduct_wallet_balance`.
    - [x] التحقق من الرصيد الكافي قبل الشراء.
    - [x] تحديث أرصدة الحزم/الاشتراكات في قاعدة البيانات بعد الشراء الناجح.
    - [ ] منع شراء نفس الحزمة أكثر من مرة شهرياً (إذا كان هذا هو المطلوب - *تحتاج لتوضيح*).
- [ ] **تكامل بوابة الدفع Plisio:**
    - [ ] تثبيت مكتبة Plisio (إذا لزم الأمر).
    - [ ] إنشاء وظائف لإنشاء طلبات دفع Plisio باستخدام نجوم تليجرام.
    - [ ] إنشاء معالج (webhook أو callback handler) لاستقبال تأكيدات الدفع من Plisio.
    - [ ] تحديث `wallet_balance` للمستخدم عند استلام تأكيد دفع ناجح.
    - [ ] إضافة أزرار شراء رصيد المحفظة في `/account`.

## المرحلة 3: النماذج الذكية والميزات المتقدمة (الخطوة 006)

- [ ] **تكامل نماذج الذكاء الاصطناعي:**
    - [ ] إنشاء ملف `ai_handlers.py` (أو ما شابه) لمنطق التفاعل مع APIs المختلفة (Gemini, GPT, Claude, etc.).
    - [ ] استخدام مفاتيح API المخزنة في قاعدة البيانات.
    - [ ] التعامل مع أنواع الطلبات المختلفة (نص، صورة، فيديو، أغنية).
    - [ ] تطبيق نظام تكلفة الطلبات وربطه بـ `consume_request`.
    - [ ] إخفاء/إظهار أزرار النماذج بناءً على توفر مفاتيح API النشطة.
- [ ] **إدارة السياق (`database.py`, `ai_handlers.py`):**
    - [ ] التأكد من حفظ واسترجاع سياق المحادثة بشكل صحيح.
    - [ ] تطبيق أمر `/deletecontext`.
- [ ] **دعم تعدد اللغات:**
    - [ ] اختيار مكتبة مناسبة (مثل `python-i18n`).
    - [ ] نقل جميع النصوص الثابتة إلى ملفات لغة (مثل `locales/ar.json`, `locales/en.json`).
    - [ ] تعديل الكود لاستخدام دوال الترجمة بناءً على لغة المستخدم (المخزنة في `users` أو من `update.effective_user.language_code`).
    - [ ] تحديث `keyboards.py` لدعم الأزرار متعددة اللغات.
    - [ ] إضافة زر اختيار اللغة في `/settings`.
- [ ] **تطوير ميزات الأوامر:**
    - [ ] تنفيذ منطق الأوامر `/midjourney`, `/video`, `/photo`, `/suno`, `/s` كما هو موضح.
    - [ ] تنفيذ منطق أمر `/settings` كاملاً (اختيار النموذج، التعليمات المخصصة، السياق، الردود الصوتية، اللغة).
    - [ ] تنفيذ أمر `/podcast`.

## المرحلة 4: الاختبار والتوثيق والتسليم (الخطوات 007-009)

- [ ] **الاختبار الشامل:**
    - [ ] اختبار جميع الأوامر والوظائف.
    - [ ] اختبار سيناريوهات الشراء والدفع.
    - [ ] اختبار إدارة المسؤولين والمفاتيح.
    - [ ] اختبار تعدد اللغات.
- [ ] **إعداد الشرح:**
    - [ ] كتابة شرح مفصل لهيكلية الكود وطريقة عمل البوت.
    - [ ] توضيح كيفية إضافة نماذج أو لغات جديدة.
- [ ] **التسليم:**
    - [ ] إرسال الكود النهائي مع الشرح للمستخدم.
    - [ ] التأكد من تحديث `requirements.txt`.

